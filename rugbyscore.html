<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&display=swap');
        :root { --ss-navy: #0a1428; --ss-gold: #f8b739; --ss-blue: #1a2a4a; --ss-red: #ff3b3b; }
        body { background: transparent; margin: 0; padding: 20px; font-family: 'Oswald', sans-serif; color: white; text-transform: uppercase; }

        /* SCOREBOARD */
        .scoreboard-wrapper { position: relative; width: fit-content; }
        .scoreboard-container { display: flex; align-items: center; background: var(--ss-navy); border-bottom: 4px solid var(--ss-gold); height: 55px; position: relative; z-index: 10; }
        .period-box { background: var(--ss-gold); color: black; height: 100%; padding: 0 12px; display: flex; align-items: center; font-weight: 700; font-size: 18px; }
        .team-box { display: flex; align-items: center; padding: 0 20px; height: 100%; min-width: 110px; justify-content: center; }
        .score-box { background: #fff; color: var(--ss-navy); height: 100%; min-width: 65px; display: flex; justify-content: center; align-items: center; font-size: 34px; font-weight: 700; transform: skewX(-15deg); margin: 0 8px; }
        .score-box span { transform: skewX(15deg); }
        .timer-box { background: var(--ss-blue); padding: 0 20px; height: 100%; display: flex; align-items: center; font-size: 26px; color: var(--ss-gold); border-left: 1px solid rgba(255,255,255,0.1); min-width: 85px; }
        .red-time { color: var(--ss-red) !important; }

        /* ANIMATION BELOW */
        #eventTicker { position: absolute; top: 59px; left: 0; width: 100%; height: 32px; font-weight: 700; font-size: 16px; display: flex; justify-content: center; align-items: center; transform: translateY(-100%); transition: transform 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28); z-index: 1; }
        #eventTicker.active { transform: translateY(0); }

        /* CONTROL INTERFACE */
        #setup-screen { background: #111; padding: 20px; border-radius: 10px; width: 400px; margin-top: 50px; border: 1px solid var(--ss-gold); }
        #remote-ui { display: none; background: #111; padding: 20px; width: 800px; margin-top: 50px; border-radius: 10px; text-transform: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        button { padding: 10px; cursor: pointer; font-weight: bold; border: none; border-radius: 4px; background: #333; color: white; font-family: 'Oswald'; }
        input { background: #222; color: #fff; border: 1px solid #444; padding: 8px; width: 100%; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="scoreboard-wrapper">
    <div class="scoreboard-container">
        <div class="period-box" id="periodDisp">1ST</div>
        <div class="team-box" id="homeBg"><div id="homeNameDisp">HOME</div></div>
        <div class="score-box"><span id="homeScore">0</span></div>
        <div class="score-box"><span id="awayScore">0</span></div>
        <div class="team-box" id="awayBg"><div id="awayNameDisp">AWAY</div></div>
        <div class="timer-box" id="timerBox"><div id="timerDisp">00:00</div></div>
    </div>
    <div id="eventTicker">EVENT</div>
</div>

<div id="setup-screen">
    <h3>Connection Settings</h3>
    <p style="font-size: 12px;">Your ID: <b id="my-id">...</b></p>
    <input type="text" id="target-id" placeholder="Paste ID to Control">
    <button onclick="connectToPeer()" style="width:100%; margin-top:10px; background:var(--ss-gold); color:black;">CONNECT AS REMOTE</button>
</div>

<div id="remote-ui">
    <div class="grid">
        <div><label>Home</label><input type="text" id="hN" value="HOME" oninput="sendData()"><input type="color" id="hC" value="#0a1428" oninput="sendData()"></div>
        <div><label>Away</label><input type="text" id="aN" value="AWAY" oninput="sendData()"><input type="color" id="aC" value="#0a1428" oninput="sendData()"></div>
        <div><label>Red Time</label><input type="number" id="rL" value="40" oninput="sendData()"></div>
    </div>
    <div class="grid">
        <button onclick="doAction('hS', 5, 'TRY')">HOME TRY</button>
        <button onclick="doAction('aS', 5, 'TRY')">AWAY TRY</button>
        <button id="clkBtn" onclick="doAction('toggleClock')">START</button>
        <button onclick="doAction('hS', 3, 'PENALTY GOAL')">HOME PG</button>
        <button onclick="doAction('aS', 3, 'PENALTY GOAL')">AWAY PG</button>
        <button onclick="doAction('resetClock')">RESET</button>
    </div>
    <div class="grid">
        <div><label>Home Anim Color</label><input type="color" id="hA" value="#f8b739" oninput="sendData()"></div>
        <div><label>Away Anim Color</label><input type="color" id="aA" value="#f8b739" oninput="sendData()"></div>
    </div>
</div>

<script>
    let peer = new Peer();
    let conn;
    let state = { hN: 'HOME', aN: 'AWAY', hS: 0, aS: 0, hC: '#0a1428', aC: '#0a1428', hA: '#f8b739', aA: '#f8b739', p: '1ST', sec: 0, run: false, rL: 40 };

    peer.on('open', id => document.getElementById('my-id').innerText = id);

    // Receiver (OBS Window)
    peer.on('connection', c => {
        conn = c;
        document.getElementById('setup-screen').style.display = 'none';
        setupDataListener();
    });

    // Sender (Remote Window)
    function connectToPeer() {
        const targetId = document.getElementById('target-id').value;
        conn = peer.connect(targetId);
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('remote-ui').style.display = 'block';
        setupDataListener();
    }

    function setupDataListener() {
        conn.on('data', data => {
            if(data.type === 'STATE') { state = data.val; render(); }
            if(data.type === 'ANIM') triggerAnim(data.txt, data.col);
        });
    }

    function sendData() {
        state.hN = document.getElementById('hN').value;
        state.aN = document.getElementById('aN').value;
        state.hC = document.getElementById('hC').value;
        state.aC = document.getElementById('aC').value;
        state.hA = document.getElementById('hA').value;
        state.aA = document.getElementById('aA').value;
        state.rL = document.getElementById('rL').value;
        conn.send({type: 'STATE', val: state});
    }

    function doAction(type, val, msg) {
        if(type === 'hS') { state.hS += val; conn.send({type:'ANIM', txt: msg + " - " + state.hN, col: state.hA}); }
        if(type === 'aS') { state.aS += val; conn.send({type:'ANIM', txt: msg + " - " + state.aN, col: state.aA}); }
        if(type === 'toggleClock') state.run = !state.run;
        if(type === 'resetClock') { state.sec = 0; state.run = false; }
        sendData();
    }

    function render() {
        document.getElementById('homeNameDisp').innerText = state.hN;
        document.getElementById('awayNameDisp').innerText = state.aN;
        document.getElementById('homeScore').innerText = state.hS;
        document.getElementById('awayScore').innerText = state.aS;
        document.getElementById('homeBg').style.background = state.hC;
        document.getElementById('awayBg').style.background = state.aC;
        let m = Math.floor(state.sec / 60), s = state.sec % 60;
        document.getElementById('timerDisp').innerText = (m<10?'0':'')+m+":"+(s<10?'0':'')+s;
        document.getElementById('timerBox').classList.toggle('red-time', (state.sec >= state.rL * 60));
        if(document.getElementById('remote-ui').style.display === 'block') {
            document.getElementById('clkBtn').innerText = state.run ? "STOP" : "START";
        }
    }

    function triggerAnim(txt, col) {
        const t = document.getElementById('eventTicker');
        t.innerText = txt; t.style.background = col;
        t.classList.remove('active'); void t.offsetWidth; t.classList.add('active');
        setTimeout(() => t.classList.remove('active'), 4000);
    }

    setInterval(() => { if(state.run) { state.sec++; render(); } }, 1000);
</script>
</body>
</html>